	<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>D3 Multi Series Line Chart - jsFiddle demo</title>
  
  <script src='../js/jquery-3.2.1.min.js'></script>
  <script type='text/javascript' src='../js/d3.v3.min.js'></script>
  
  <script language="javascript" src="../includes/calendar.js"></script>
  
<link rel="stylesheet" type="text/css" href="../css/solarStyle.css">
<link href='../css/solarStyle.css' type='text/css' rel='stylesheet'>
<link href='../css/bootstrap.min.css' type='text/css' rel='stylesheet'>
<link href='../css/bootstrap-theme.min.css' type='text/css' rel='stylesheet'>

<script src='../js/bootstrap.min.js'></script>
  
  
  
  <style type='text/css'>
        body {
        font: 16px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

    .element text {
        text-anchor: end;
    }

    .area {
        opacity: 0.9;
    }
  </style>
  
 
  


<script type='text/javascript'>  
window.onload=function(){




var rows;
var theData3 = {};

   console.log('at start Size of theData3 object: '+ Object.keys(theData3).length);



d3.json("getPredictedVsActual3.php", function(loadedRows) {
  rows = loadedRows;
  doSomethingWithRows();
});

function doSomethingWithRows() {
	
var margin = {top: 20, right: 20, bottom: 60, left: 100},
        width = 1150 - margin.left - margin.right,
        height = 550 - margin.top - margin.bottom;

//var parseDate = d3.time.format("%Y%m%d").parse;
var parseDate = d3.time.format("%Y-%m-%d %H:%M:%S").parse;

var x = d3.time.scale()
        .range([0, width]);

//var y = d3.scale.linear().range([0, height]);
        
var y = d3.scale.linear().range([height, 0]);

var color = d3.scale.category20();

var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");
        


var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left");

var area = d3.svg.area()
        .interpolate("basis")
        .x(function (d) {
            return x(parseDate(d.key));
        })
        .y0(height)
        .y1(function (d) {
            return y(d.value);
        });

var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        

//d3.csv("getPernodData2.php", function(error, data) {
		
		//console.log ( 'in d3.csv data:'+ data );
	//document.write(data);
	//document.write('data:' + data + '<br>');
	
		//theData = data;
		//document.write('theData:' + theData + '<br>');	
		
	//});

//document.write('data again:' + data + '<br>');
//document.write('theData again:' + theData + '<br>');	

var myobj = JSON.parse('{ "hello":"world" }');

console.log('Size of myobj object: '+ Object.keys(myobj).length);

//var myobj2 = JSON.parse( '{ "Series 1": {"20141020": 3.5003987252672744,"20141019": 2.505802351020492,"20141018": 1.511804171940014,"20141015": 1.466520821512944,"20141014": 2.458051096911987,"20141017": 0.518412786499141,"20141016": 0.4743643618143949,"20141013": 3.4489507475146013} }');

//console.log('Size of myobj2 object: '+ Object.keys(myobj2).length);

//d3.csv("getPernodData2.php", function(loadedRows) {
//  rows = loadedRows;
//  doSomethingWithRows();
//});

  // do something with rows
  var theObject = {};
  console.log ( 'in doSomethingWithRows rows:'+ rows );
  console.log('Size of rows object: '+ Object.keys(rows).length);
  
 // var rowsObject = JSON.parse(rows);
  
  //theObject = toObject(rows);
  
    //console.log ( 'in doSomethingWithRows theObject:'+ theObject );
    //console.log('in doSomethingWithRows Size of theObject object: '+ Object.keys(theObject).length);
    
    theData3 = rows;
    
   console.log('in doSomethingWithRows Size of theData3 object: '+ Object.keys(theData3).length);
   
   
//console.log('before entries theData Size of theObject object: '+ Object.keys(theData).length);
console.log('before entries theData Size of theData3 object: '+ Object.keys(theData3).length);

//var entries = d3.entries(theData);
//var entries = d3.entries(myobj2);
var entries = d3.entries(theData3);

color.domain(entries.map(function (d) {
	return d;
}));

var allX = d3.values(theData3).map(d3.keys)
    .reduce(function(a,b) { return a.concat(b); }).map(parseDate);
var allY = d3.values(theData3).map(d3.values)
    .reduce(function(a,b) { return a.concat(b); });

x.domain(d3.extent(allX));
y.domain(d3.extent(allY));

var element = svg.selectAll(".element")
		.data(entries)
		.enter().append("g")
		.attr("class", "element");

element.append("path")
		.attr("class", "area")
		.attr("d", function (d) {
			var entry = d3.entries(d.value);
			return area(entry);
		})
		.style("fill", function (d) {
			return color(d.key);
			//return color("green");
			//return "#FF0000";
		});

element.append("text")
		.datum(function (d) {
			var entry = d3.entries(d.value);
			return {
				name: d.key,
				date: parseDate(entry[entry.length - 1].key),
				value: entry[entry.length - 1].value
			};
		})
		.attr("transform", function (d) {
			return "translate(" + x(d.date) + "," + y(d.value) + ")";
		})
		.attr("x", -6)
		.attr("dy", ".35em")
		.text(function (d) {
			return d.name;
		});

svg.append("g")
		.attr("class", "x axis")
		.attr("transform", "translate(0," + height + ")")
		.call(xAxis);

svg.append("g")
		.attr("class", "y axis")
		.call(yAxis);
		
// Add the text label for the x axis
    svg.append("text")
        .attr("transform", "translate(" + (width / 2) + " ," + (height + margin.bottom) + ")")
        .style("text-anchor", "middle")
        .text("Datetime")

		    // Add the text label for the Y axis
    svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0 - margin.left)
        .attr("x",0 - (height / 2))
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("kWh MAX = 1");	
  
} //end of doSomethingWithRows  


//console.log ( 'before entries theData:'+ theData );
 // console.log('before entries Size of rows object: '+ Object.keys(rows).length);
  
	

}//]]>  

</script>


</head>
<body>

<form method=POST action="predictedVsActual5.html">

  
<?php

require_once('../classes/tc_calendar.php');
require_once "/var/www/html/solarquant/classes/PatternSet.php";

require_once "/var/www/html/solarquant/classes/ConsumptionPatternSet.php";

$theConsumptionPatternSet = new ConsumptionPatternSet();

// Start the session
session_start();

//echo("session[startdate]".$_SESSION['startDate']."<br>");
//echo("REQUEST[startdate]".$_REQUEST['startDate']."<br>");

//echo("session[patternSetId]".$_SESSION['patternSetId']."<br>");



//exit;
		
	
		if (!isset($_SESSION["startDate"]))
		{

		//construct from id
		$thePatternSet = new PatternSet();
		$thePatternSet->id = $_SESSION["patternSetId"];
		$thePatternSet->constructFromId();
		
		$_SESSION["startDate"] = $thePatternSet->startDate;
		$_SESSION["endDate"] = $thePatternSet->endDate;
		
		}
		else
		{
		
		}
		
		if (isset($_REQUEST["startDate"]))
		{	

//echo("request[startdate]".$_REQUEST['startDate']."<br>");
//echo("request[enddate]".$_REQUEST['endDate']."<br>");

$_SESSION["startDate"] = $_REQUEST['startDate'];
$_SESSION["endDate"] = $_REQUEST['endDate'];

		}

        //calc and show STDEV
        $standardDev = $theConsumptionPatternSet->getStandardDeviation($_SESSION["patternSetId"],$_SESSION['startDate'],$_SESSION['endDate']);
        //$standardDev = $theConsumptionPatternSet->getStandardDeviation($_SESSION["patternSetId"],$_REQUEST['startDate'],$_REQUEST['endDate']);
        echo (" Standard Deviation:".$standardDev."<br><br>");

$dateStartPieces = explode("-", $_SESSION["startDate"]);
$dateEndPieces = explode("-", $_SESSION["endDate"]);



$theStartYear = $dateStartPieces[0];
$theStartMonth = $dateStartPieces[1];
$theStartDay = $dateStartPieces[2];

$theEndYear = $dateEndPieces[0];
$theEndMonth = $dateEndPieces[1];
$theEndDay = $dateEndPieces[2];

/*
echo("theStartMonth:".$theStartYear."<br>");
echo("theStartMonth:".$theStartMonth."<br>");
echo("theStartDay:".$theStartDay."<br>");

echo("theEndYear:".$theEndYear."<br>");
echo("theEndMonth:".$theEndMonth."<br>");
echo("theEndDay:".$theEndDay."<br>");
*/

echo("<script language='javascript' src='../includes/calendar.js'></script>");


//instantiate class and set properties
$myCalendar = new tc_calendar("startDate", true);
$myCalendar->setIcon("images/iconCalendar.gif");
//$myCalendar->setDate('02', '03', '2016');
$myCalendar->setDate($theStartDay, $theStartMonth, $theStartYear);

//output the calendar
$myCalendar->writeScript();

//instantiate class and set properties
$myCalendar2 = new tc_calendar("endDate", true);
$myCalendar2->setIcon("images/iconCalendar.gif");
//$myCalendar2->setDate('02', '04', '2016');
$myCalendar2->setDate($theEndDay, $theEndMonth, $theEndYear);

//output the calendar
$myCalendar2->writeScript();

?>

<input type="submit" value="Submit">

</form>

<?php

// Start the session
//session_start();

//echo ("<br><br>epoch:".$_SESSION["epoch"]." batch:".$_SESSION["batch"]);



?>

</body>


</html>


